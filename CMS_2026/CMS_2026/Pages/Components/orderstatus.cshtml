@model CMS_2026.Data.Entities.PP_Page
@using CMS_2026.Pages
@using CMS_2026.Services
@using CMS_2026.Data.Entities
@inject RootService Root
@inject IDataService Db
@{
    var langId = Context.Request.Cookies["LangId"] ?? "vi";
    var config = Root.GetConfig(langId);
    var orderCode = Context.Request.Query["code"].FirstOrDefault() ?? "";
    
    var order = !string.IsNullOrEmpty(orderCode) 
        ? Db.GetOne<PP_Order>(t => t.OrderCode == orderCode) 
        : null;
}

<section class="order-status-section">
    <div class="container">
        <div class="row">
            <div class="col-12">
                @if (order != null)
                {
                    <h2>Trạng thái đơn hàng</h2>
                    <div class="order-info">
                        <p><strong>Mã đơn hàng:</strong> @order.OrderCode</p>
                        <p><strong>Trạng thái:</strong> @order.OrderStatus</p>
                        <p><strong>Tổng tiền:</strong> @order.TotalAmount.ToString("#,##0") đ</p>
                        <p><strong>Ngày đặt:</strong> @order.CreatedTime.ToString("dd/MM/yyyy HH:mm")</p>
                    </div>
                }
                else
                {
                    <h2>Tra cứu đơn hàng</h2>
                    <form method="get">
                        <div class="form-group">
                            <label>Mã đơn hàng</label>
                            <input type="text" name="code" class="form-control" value="@orderCode" />
                        </div>
                        <button type="submit" class="btn btn-primary">Tra cứu</button>
                    </form>
                    @if (!string.IsNullOrEmpty(orderCode))
                    {
                        <p class="mt-3 text-danger">Không tìm thấy đơn hàng với mã: @orderCode</p>
                    }
                }
            </div>
        </div>
    </div>
</section>

