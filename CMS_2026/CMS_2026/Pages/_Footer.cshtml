@model CMS_2026.Models.Config
@using CMS_2026.Services
@using CMS_2026.ViewModels
@using CMS_2026.Common
@using CMS_2026.Data.Entities
@using Microsoft.Extensions.Caching.Memory
@using Newtonsoft.Json
@inject RootService Root
@inject IDataService Db
@inject IMemoryCache Cache
@{
    var langId = Context.Request.Cookies["LangId"] ?? "vi";
    var config = Root.GetConfig(langId);
    
    // Load FooterViewModel from component config
    var footerData = FooterViewModel.Default;
    var comptConfig = CMS_2026.Common.Root.Configs.Values
        .FirstOrDefault(t => t.LangId == langId && t.PageId == 0 && 
            (t.ConfigKey == "layout_footer" || t.ConfigKey == "FooterViewModel" || t.ConfigKey == "layout_FooterViewModel"));
    
    if (comptConfig != null && !string.IsNullOrEmpty(comptConfig.JsonContent))
    {
        try
        {
            footerData = JsonConvert.DeserializeObject<FooterViewModel>(comptConfig.JsonContent) ?? FooterViewModel.Default;
        }
        catch
        {
            // Use default if deserialization fails
        }
    }
}

<footer class="pt-15 pt-lg-20 pb-16 footer bg-section-4" style="background-color: #FFF8E1!important">
    <div class="container container-xxl pt-4">
        <div class="row">
            <div class="col-lg col-md-4 col-12 mb-11 mb-lg-0 fs-14px">
                <h3 class="fs-5 mb-6">@(footerData.Titlemain ?? config.WebTitle)</h3>
                @Html.Raw(footerData.Des ?? config.WebDescription)
            </div>
            <div class="col-lg col-md-4 col-12 mb-11 mb-lg-0">
                <h3 class="fs-5 mb-6">@(langId == "en" ? "Useful links" : "Các liên kết")</h3>
                <ul class="list-unstyled mb-0 fw-medium">
                    @if (footerData.link != null)
                    {
                        @foreach (var item in footerData.link.EmptyIfNull())
                        {
                            <li class="pt-3 mb-4">
                                <a href="@item.link" title="@item.Title" class="text-body">@item.Title</a>
                            </li>
                        }
                    }
                </ul>
            </div>
            <div class="col-lg col-md-4 col-12 mb-11 mb-lg-0">
                <h3 class="fs-5 mb-6">@(langId == "en" ? "Information" : "Thông tin")</h3>
                <ul class="list-unstyled mb-0 fw-medium">
                    @if (footerData.link1 != null)
                    {
                        @foreach (var item in footerData.link1.EmptyIfNull())
                        {
                            <li class="pt-3 mb-4">
                                <a href="@item.link" title="@item.Title" class="text-body">@item.Title</a>
                            </li>
                        }
                    }
                </ul>
            </div>
            <div class="col-lg-5 col-12 mb-11 mb-lg-0">
                <h3 class="mb-4">@(footerData.newsletter?.Title ?? (langId == "en" ? "Newsletter" : "Đăng ký nhận tin"))</h3>
                <p class="lh-2">@(footerData.newsletter?.Content ?? (langId == "en" ? "Subscribe to our newsletter to get updates on new products and special offers." : "Đăng ký nhận tin để cập nhật sản phẩm mới và ưu đãi đặc biệt."))</p>
                <form class="pt-8 subscribe-form" action="/Api/Subscribe" method="post">
                    <div class="input-group position-relative">
                        <input type="email" name="emailRegister" class="form-control bg-body rounded-left" placeholder="Email" style="border-color: #4EA87C!important" required>
                        <button type="submit" class="btn btn-dark register-button btn-hover-bg-primary btn-hover-border-primary ms-0">
                            @(langId == "en" ? "Subscribe" : "Đăng ký")
                        </button>
                    </div>
                </form>
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        const form = document.querySelector('.subscribe-form');
                        if (form) {
                            form.addEventListener('submit', async function(e) {
                                e.preventDefault();
                                const formData = new FormData(form);
                                const button = form.querySelector('button[type="submit"]');
                                const originalText = button.textContent;
                                button.disabled = true;
                                button.textContent = '@(langId == "en" ? "Subscribing..." : "Đang xử lý...")';
                                
                                try {
                                    const response = await fetch('/Api/Subscribe', {
                                        method: 'POST',
                                        body: formData
                                    });
                                    const result = await response.json();
                                    
                                    if (result.success) {
                                        if (typeof Toastify !== 'undefined') {
                                            Toastify({
                                                text: result.message || '@(langId == "en" ? "Subscribed successfully!" : "Đăng ký thành công!")',
                                                duration: 3000,
                                                gravity: "top",
                                                position: "right",
                                                backgroundColor: "#4caf50"
                                            }).showToast();
                                        }
                                        form.reset();
                                    } else {
                                        if (typeof Toastify !== 'undefined') {
                                            Toastify({
                                                text: result.message || '@(langId == "en" ? "Subscription failed" : "Đăng ký thất bại")',
                                                duration: 3000,
                                                gravity: "top",
                                                position: "right",
                                                backgroundColor: "#f44336"
                                            }).showToast();
                                        }
                                    }
                                } catch (error) {
                                    if (typeof Toastify !== 'undefined') {
                                        Toastify({
                                            text: '@(langId == "en" ? "An error occurred" : "Có lỗi xảy ra")',
                                            duration: 3000,
                                            gravity: "top",
                                            position: "right",
                                            backgroundColor: "#f44336"
                                        }).showToast();
                                    }
                                } finally {
                                    button.disabled = false;
                                    button.textContent = originalText;
                                }
                            });
                        }
                    });
                </script>
            </div>
        </div>
        <div class="row align-items-center mt-0 mt-lg-20 pt-lg-4">
            <div class="col-sm-12 col-md-6 col-lg-4 d-flex align-items-center fs-6 mt-8 mt-lg-0">
                <ul class="list-inline fs-18px ms-6 mb-0">
                    @if (!string.IsNullOrEmpty(config.LinkTwitter) && config.LinkTwitter != "#")
                    {
                        <li class="list-inline-item me-8">
                            <a href="@config.LinkTwitter" target="_blank"><i class="fab fa-twitter"></i></a>
                        </li>
                    }
                    @if (!string.IsNullOrEmpty(config.LinkFacebook))
                    {
                        <li class="list-inline-item me-8">
                            <a href="@config.LinkFacebook" target="_blank"><i class="fab fa-facebook-f"></i></a>
                        </li>
                    }
                    @if (!string.IsNullOrEmpty(config.LinkInstagram))
                    {
                        <li class="list-inline-item me-8">
                            <a href="@config.LinkInstagram" target="_blank"><i class="fab fa-instagram"></i></a>
                        </li>
                    }
                    @if (!string.IsNullOrEmpty(config.LinkYoutube))
                    {
                        <li class="list-inline-item">
                            <a href="@config.LinkYoutube" target="_blank"><i class="fab fa-youtube"></i></a>
                        </li>
                    }
                </ul>
            </div>
            <div class="col-sm-12 col-lg-4 text-md-center">
                <a class="d-inline-block" href="/">
                    <img class="lazy-image dark-mode-img img-fluid" src="@config.Logo" width="179" height="26" alt="@config.WebTitle">
                </a>
            </div>
            <div class="col-sm-12 col-md-6 col-lg-4 d-flex align-items-center fs-6 mt-8 mt-lg-0">
                <p class="mb-0">
                    @(config.Company.CopyrightText ?? $"© {DateTime.Now.Year} {config.WebTitle}")
                    @if (!string.IsNullOrEmpty(config.Company.LinkCompanyGuardCopyRight))
                    {
                        <a href="@config.Company.LinkCompanyGuardCopyRight">@config.Company.CompanyNameGuardCopyRight</a>
                    }
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- Back to Top Button -->
<div class="position-fixed z-index-10 bottom-0 end-0 p-10">
    <a href="#" class="gtf-back-to-top text-decoration-none bg-body text-primary bg-primary-hover text-light-hover shadow square p-0 rounded-circle d-flex align-items-center justify-content-center" title="Back To Top" style="--square-size: 48px">
        <i class="fa-solid fa-arrow-up"></i>
    </a>
</div>

<!-- SVG Icons -->
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="icon-magnifying-glass-light" viewbox="0 0 32 32">
        <path d="M31.008 27.231l-7.58-6.447c-0.784-0.705-1.622-1.029-2.299-0.998 1.789-2.096 2.87-4.815 2.87-7.737 0-6.624-5.375-11.999-12-11.999s-12 5.375-12 12 5.375 12 12 12c2.919 0 5.637-1.084 7.735-2.873-0.016 0.632 0.261 1.414 0.967 2.207l6.447 7.58c1.034 1.034 2.643 1.034 3.676 0l1.152-1.152c1.034-1.034 1.034-2.643 0-3.676zM12 20c-4.418 0-8-3.582-8-8s3.582-8 8-8 8 3.582 8 8-3.582 8-8 8z"></path>
    </symbol>
    <symbol id="icon-shopping-bag-open-light" viewbox="0 0 32 32">
        <path d="M26 10h-4v-2c0-3.314-2.686-6-6-6s-6 2.686-6 6v2h-4c-1.105 0-2 0.895-2 2v16c0 1.105 0.895 2 2 2h20c1.105 0 2-0.895 2-2v-16c0-1.105-0.895-2-2-2zM12 8c0-2.209 1.791-4 4-4s4 1.791 4 4v2h-8v-2zM26 28h-20v-14h4v2c0 0.552 0.448 1 1 1s1-0.448 1-1v-2h8v2c0 0.552 0.448 1 1 1s1-0.448 1-1v-2h4v14z"></path>
    </symbol>
</svg>

